---
rsyslog_repeated_msg_reduction: true
rsyslog_rsyslog_d_files:
  20-log-routers:
    settings:
      - 'module(load="imudp")'
      - 'input(type="imudp" port="514")'
      - '$template DynFile,"/var/log/router-log/%FROMHOST%"'
      - ':source , !isequal , "server-hostname" ?DynFile'
      - ':source , !isequal , "server-hostname" stop'

caddy_features: http.prometheus
caddy_systemd_capabilities_enabled: True
caddy_systemd_capabilities: "CAP_NET_BIND_SERVICE"
caddy_additional_args: '-email network@lists.fosdem.org'
caddy_update: yes
caddy_config: |
  {{ ansible_nodename }}, {{ ansible_hostname }}.fosdem.net {
    prometheus
    gzip
    root /var/www
    log /var/log/caddy/access.log
    proxy / localhost:3000 {
      transparent
    }
  }
  grafana.n.fosdem.net {
    prometheus
    proxy / localhost:3000 {
      transparent
    }
  }
  prometheus.n.fosdem.net {
    prometheus
    basicauth / admin {{ grafana_admin_password }}
    proxy / localhost:9090 {
      transparent
    }
  }
  prime.n.fosdem.net {
    prometheus
    basicauth / admin {{ grafana_admin_password }}
    proxy / https://so2wcs.ulb.ac.be {
      transparent
      insecure_skip_verify
    }
  }
  oxidized.n.fosdem.net {
    prometheus
    basicauth / admin {{ grafana_admin_password }}
  }
  alertmanager.n.fosdem.net {
    prometheus
    basicauth / admin {{ grafana_admin_password }}
    proxy / localhost:9093 {
      transparent
    }
  }
