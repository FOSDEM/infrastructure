---
- name: install vlc-fetcher script
  copy:
    src: fetcher/vlc-fetcher.sh
    dest: /usr/local/bin/vlc-fetcher.sh
    owner: root
    group: root
    mode: 0755
  notify:
  - restart vlc-fetcher target

- name: install vlc-fetcher services
  template:
    src: fetcher/vlc-fetcher.service
    dest: "/etc/systemd/system/vlc-fetcher-{{ item }}.service"
    owner: root
    group: root
    mode: 0644
  with_items: "{{ nginx_dump_rooms }}"
  register: vlc_fetcher_services
  notify:
  - restart vlc-fetcher service

- name: enable vlc-fetcher service
  systemd:
    name: "vlc-fetcher-{{ item }}"
    enabled: yes
    state: started
    daemon_reload: yes
  with_items: "{{ nginx_dump_rooms }}"

- name: install vlc-fetcher target
  template:
    src: fetcher/vlc-fetcher.target
    dest: /etc/systemd/system/vlc-fetcher.target
    owner: root
    group: root
    mode: 0644
  notify:
  - restart vlc-fetcher target

- name: start and enable vlc-fetcher target
  become: true
  systemd:
    daemon_reload: true
    name: vlc-fetcher.target
    state: started
    enabled: true
