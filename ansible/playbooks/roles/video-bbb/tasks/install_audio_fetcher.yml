---

- name: "install packages"
  apt:
    state: latest
    package:
    - python-requests
    - python-pip

- name: "install prometheus_client"
  pip:
    name: prometheus_client

- name: install audiofetcher service
  template:
    src: templates/audio-fetcher.service
    dest: /etc/systemd/system
    owner: root
    group: root
    mode: 0644
  notify: restart vocto

- name: install audio-fetcher binary
  copy:
    src: files/audio-fetcher/audio-fetcher
    dest: /usr/local/bin
    owner: root
    group: root
    mode: 0755

- name: enable and start all audiofetcher
  service:
    name: audio-fetcher
    state: started
    enabled: true
    daemon_reload: true
