---
- name: Deploy file_sd targets
  template:
    src: "{{ item }}"
    dest: "{{ prometheus_config_dir }}/file_sd/"
    owner: prometheus
    group: prometheus
    mode: 0644
  with_fileglob:
  - file_sd/*.yml

- name: Create discovery files from inventory
  template:
    src: "file_sd.yml.j2"
    dest: "{{ prometheus_config_dir }}/file_sd/{{ item.name }}.yml"
    owner: prometheus
    group: prometheus
    mode: 0644
  with_items: "{{ prometheus_hostgroup_targets }}"
