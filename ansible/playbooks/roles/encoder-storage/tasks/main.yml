---
- name: install the NFS server
  apt:
    state: latest
    install_recommends: false
    package:
    - nfs-kernel-server

- name: "add exports"
  blockinfile:
    create: true
    dest: /etc/exports
    block: |
      /srv/sreview 10.0.0.0/8(rw,sync,no_subtree_check,no_root_squash)
  register: reviewstorage_nfs_exported

- name: "restart the NFS server when needed"
  service:
    name: nfs-server
    state: restarted
  when: reviewstorage_nfs_exported.changed

- name: "create assets directory"
  file:
    path: /srv/sreview/assets
    state: directory

- name: "create other directories"
  file:
    path: /srv/sreview/{{ item }}
    state: directory
    owner: 2000
    group: 2000
  with_items:
  - storage
  - output

- name: "Create email templates"
  template:
    dest: /srv/sreview/assets/{{ item }}
    src: "{{ item }}"
    owner: root
    group: root
    mode: 0644
  with_items:
  - announce_email.ep.j2
  - notify_email.ep.j2
