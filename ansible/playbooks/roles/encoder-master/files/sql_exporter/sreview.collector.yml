---
collector_name: sreview

metrics:
- metric_name: talkstate
  type: gauge
  help: 'Number of talks in a given state'
  key_labels:
  - state
  values:
  - count
  query: |
    WITH all_states AS (
    SELECT unnest(enum_range(NULL::talkstate)) AS state
    )
    SELECT
    all_states.state,
    COALESCE(talk_counts.count, 0) AS count
    FROM all_states
    LEFT JOIN (
    SELECT state, COUNT(*) AS count
    FROM talks
    GROUP BY state
    ) AS talk_counts
    ON all_states.state = talk_counts.state;
- metric_name: video_released_seconds
  type: gauge
  help: 'Length of all the released videos added together'
  values:
  - total_time
  query: |
    SELECT COALESCE(EXTRACT(EPOCH FROM SUM((endtime - starttime)::INTERVAL)), 0) AS total_time FROM talks WHERE state = 'done';

